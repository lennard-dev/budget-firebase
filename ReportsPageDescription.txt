## Claude Code Prompt: Build Reports Page with Monthly Financial Reporting

Create a comprehensive Reports page for the Budget Management application that enables monthly financial report generation, tracking, and export. The page should integrate seamlessly with the existing application's design patterns and data structures.

### **Core Page Structure**

Build a Reports page with two main views controlled by tabs:
1. **Report Overview** - Historical list of all generated reports
2. **Report Generation** - Interface for creating/editing monthly reports

### **Page Layout & Components**

#### **Top Section (Shared Across Both Tabs)**
Create four metric cards matching the existing app's card design:
- **Current Month Status**: Show "July 2025: Draft" or "July 2025: Final" based on report state
- **Total Variance**: Calculate and display total budget variance for the month (red for over, green for under)
- **Explanations Needed**: Count categories with >10% variance that need explanations
- **Last Report Sent**: Show date of most recently finalized report

#### **Tab 1: Report Overview**
Implement a table within a card showing all reports:
- **Columns**: Month, Generated Date, Status (Draft/Final), Created By, Actions
- **Actions**: Three-dot menu with options to View, Edit (drafts only), Export PDF, or Reopen (finals only)
- **Sorting**: Default to newest first
- **Row Click**: Opens the report in read-only view

#### **Tab 2: Report Generation**
Create the main report editing interface with these sections:

**Control Bar:**
- Month selector (dropdown) defaulting to current month
- Action buttons aligned right: "Save Draft", "View Preview", "Finalize Report", "Export PDF"
- Save Draft: Saves current state without validation
- View Preview: Opens read-only version in new tab
- Finalize Report: Validates all required fields, then marks as final and moves to Report Overview

**Executive Summary Card:**
- Four inline metrics: Total Budget, Total Spent, Net Variance, Budget Utilization %
- Large text area for executive summary narrative
- Auto-calculate metrics from budget and expense data

**Two-Column Layout Section:**

*Left Column (60% width):*
**Budget vs Actual Table Card**
- Headers: Category, Budget, Actual, Variance
- Collapsible parent categories (indicated by chevron icons)
- Red dot indicator for categories needing explanation (>10% variance)
- Variance column shows amount with color coding (red/green)
- When collapsed, only show parent category totals
- Subcategories indented under parents when expanded

*Right Column (40% width):*
**Variance Explanations Card**
- Dynamically generate text inputs for each flagged category
- Format: "CategoryName (€XXX over):" with text input below
- Only show categories that need explanations
- Pre-populate with any previously saved explanations

**Full-Width Sections Below:**

**Additional Notes Card:**
- Text area for general observations about the month
- Placeholder: "General observations and notes about this month's financial performance..."

**Upcoming Expenses Card:**
- Text area for next month's expected costs
- Placeholder: "Expected costs and planned expenditures for next month..."

**Detailed Expenses - Past 3 Months Card:**
- Table showing 3-month comparison (May, June, July)
- Structure: Category/Subcategory column, then one column per month
- Show actual amounts with budget amounts below in gray
- Collapsible categories matching the Budget vs Actual structure
- Color code cells: green if under budget, red if over

**Year-to-Date Budget vs Actual Card:**
- Line chart showing monthly budget vs actual trends
- Two lines: Budget (blue) and Actual (green)
- X-axis: Months (Jan-Dec)
- Y-axis: Amount in euros
- Show data points with hover tooltips

**Financial Position Card:**
- Four metric boxes: Bank Balance, Cash on Hand, Monthly Burn Rate, Months Remaining
- Pull Bank Balance and Cash on Hand from Cash & Banking data
- Calculate burn rate from current month's expenses
- Calculate months remaining: (Bank Balance + Cash) / Burn Rate
- Add explanatory text below metrics if needed

### **Data Flow & State Management**

**Report States:**
- **Empty**: No report exists for selected month (show "Generate Report" button)
- **Draft**: Report in progress, all fields editable
- **Final**: Report completed, read-only except can be reopened

**Data Sources:**
- Pull expense data from Expenses page for selected month
- Pull budget data from Budget page for selected month
- Pull cash/bank data from Cash & Banking page
- Store report-specific data (explanations, notes, executive summary) separately

**Variance Calculation Logic:**
- Calculate at category level only (not subcategories)
- Flag if variance > 10% OR > €100
- Auto-detect which categories need explanations
- Preserve explanations when switching between months

### **Report View Page**

When viewing a finalized report (accessed from Report Overview or View Preview):
- Display all the same sections but in read-only format
- Add header with: "Monthly Report - July 2025", "Generated on August 5, 2025 by Admin User"
- Include "Back to Reports" link and "Export PDF" button in top right
- Show "Final" badge in green
- Display saved explanations inline with the budget table
- Maintain collapsed/expanded state of categories as saved

### **Key Functionality Requirements**

1. **Auto-save**: Save draft automatically every 30 seconds when user makes changes
2. **Validation**: Before finalizing, ensure all flagged variances have explanations
3. **Data Snapshot**: When finalizing, store a snapshot of all data so report remains unchanged even if underlying data changes
4. **Export PDF**: Generate professionally formatted PDF with all sections, maintaining colors and formatting
5. **Responsive Design**: Ensure two-column layout stacks on mobile devices
6. **Loading States**: Show loading indicators when fetching data or generating reports
7. **Error Handling**: Display user-friendly error messages for validation failures or data issues

### **Design Consistency**

Match the existing application's design patterns:
- Use the same card component with white background and subtle shadows
- Apply consistent spacing between sections
- Use the same button styles (primary blue for main actions, secondary for others)
- Match the table styling from Expenses page
- Use the same color variables for variance indicators (red/green)
- Implement the same tab navigation pattern as Budget page
- Apply the same form input styles from expense entry modals

### **Implementation Notes**

- The collapsible category state should be independent for each table (Budget vs Actual, Detailed Expenses)
- Preserve user inputs in draft state even when navigating away
- Categories in all tables should match the hierarchy from the Budget page
- The "Months Remaining" calculation should show one decimal place and turn red if below 1.0
- Include tooltips on metric cards explaining what each metric represents
- Add a confirmation dialog before finalizing a report
- Implement print-friendly CSS for the PDF export

This Reports page transforms manual monthly reporting into a streamlined digital process while maintaining flexibility for narrative context and preserving historical records for audit trails.


## Reports Page Workflow Explanation

The Reports page serves as the central hub for transforming raw financial data into comprehensive monthly reports for board and stakeholder communication. When the finance manager arrives at the Reports page at the beginning of each month, they're immediately presented with the Report Overview tab showing the status of all previous reports and highlighting that the current month needs attention. Upon switching to the Report Generation tab and selecting the current month, the system automatically aggregates all expense and budget data, calculates variances, and pre-populates the Budget vs Actual tables with the month's financial performance. The intelligent variance detection system immediately flags any categories where spending exceeded budget by more than 10% or €100, marking these with red indicators and creating corresponding explanation fields in the right column. The finance manager can then review the automatically generated metrics in the Executive Summary, seeing at a glance the total budget utilization and overall variance, while the three-month comparison table provides historical context for spending patterns.

The report creation process is designed to be iterative and collaborative, allowing the finance manager to work through the report systematically while preserving their progress. As they add explanations for each flagged variance—perhaps noting that Activities went over budget due to a special donation to Zaporeak or that Transportation costs increased due to seasonal factors—the system automatically saves their work as a draft every 30 seconds. They can expand or collapse category hierarchies in the budget tables to control the level of detail shown in the final report, add narrative context in the Additional Notes section to highlight successes or concerns, and document expected expenses for the coming month. The Financial Position card at the bottom provides critical runway calculations by pulling real-time data from the Cash & Banking module, showing stakeholders exactly how many months of operations remain at the current burn rate.

Once all variances are explained and narrative sections completed, the finance manager can use the View Preview function to see exactly how the report will appear to board members, making any final adjustments before clicking Finalize Report. This action validates that all required explanations are present, creates a permanent snapshot of the data that won't change even if underlying expenses are later modified, and moves the report from draft to final status in the Report Overview. The finalized report can then be exported as a professionally formatted PDF that maintains all the visual hierarchy, color coding, and explanations, ready for distribution to the board and executive director. This systematic workflow ensures that every month's financial story is captured completely and consistently, creating both immediate communication value and a permanent audit trail of the organization's financial management decisions.