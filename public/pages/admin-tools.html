<style>
    .admin-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
    }
    .admin-section {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .admin-section h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 12px;
    }
    .admin-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    .status-message {
      margin-top: 16px;
      padding: 12px;
      border-radius: 4px;
      display: none;
    }
    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    .data-info {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 4px;
      margin: 16px 0;
    }
    .warning-box {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 12px;
      border-radius: 4px;
      margin: 16px 0;
    }
  </style>

<div class="admin-container">
    <h1>Admin Tools - Data Management</h1>
    
    <div class="admin-section">
      <h2>ðŸš€ Migrate to QuickBooks-Style Balance Tracking</h2>
      <div class="data-info">
        <strong>Professional Balance Tracking:</strong> Updates all transactions with permanent balance tracking.
        <ul>
          <li>âœ… Adds balance_after fields to all transactions</li>
          <li>âœ… Creates balance snapshots for reliable retrieval</li>
          <li>âœ… Generates audit logs for complete transaction history</li>
          <li>âœ… Server-side updates using PATCH API</li>
          <li>âœ… Makes balances permanent and filter-proof</li>
        </ul>
      </div>
      <div class="warning-box">
        ðŸ”„ This will update your database with professional-grade balance tracking. All existing transactions will be processed and updated with balance_after fields.
      </div>
      <div class="admin-actions">
        <button class="btn btn-primary" id="migrate-btn">
          ðŸ”„ Run Professional Migration
        </button>
      </div>
      <div id="migrate-status" class="status-message"></div>
    </div>
    
    <div class="admin-section">
      <h2>ðŸ“Š Data Analysis</h2>
      <div class="data-info">
        <strong>Purpose:</strong> Analyze current data integrity and architecture compliance.
        <ul>
          <li>âœ… Shows expenses breakdown by payment method</li>
          <li>âœ… Shows cash movements by type (operational flows only)</li>
          <li>âœ… Identifies any legacy cash-expense entries that need cleanup</li>
          <li>âœ… Validates separate collections architecture</li>
        </ul>
      </div>
      <div class="admin-actions">
        <button class="btn btn-secondary" id="analyze-btn">
          ðŸ“Š Analyze Current Data
        </button>
      </div>
      <div id="sync-status" class="status-message"></div>
    </div>
    
    <div class="admin-section">
      <h2>ðŸ§¹ Clean Up Legacy Cash Expenses</h2>
      <div class="data-info">
        <strong>Architecture Cleanup:</strong> Remove legacy cash-expense entries from cash-movements collection.
        <ul>
          <li>ðŸŽ¯ Removes only cash-expense type movements (legacy duplicates)</li>
          <li>âœ… Preserves operational movements (deposits, withdrawals, donations)</li>
          <li>âœ… Enforces separate collections architecture</li>
          <li>âœ… Cash expenses remain in expenses collection where they belong</li>
        </ul>
      </div>
      <div class="warning-box">
        ðŸ”„ This enforces our separate collections architecture by removing cash-expense entries from cash movements. These are legacy duplicates - the real cash expenses remain safely in the expenses collection.
      </div>
      <div class="admin-actions">
        <button class="btn btn-warning" id="cleanup-btn">
          ðŸ§¹ Clean Up Legacy Entries
        </button>
      </div>
      <div id="cleanup-status" class="status-message"></div>
    </div>

    <div class="admin-section">
      <h2>Generate Clean Test Data</h2>
      <div class="data-info">
        This will create clean test data with:
        <ul>
          <li>Cash movements: deposits, withdrawals, donations only</li>
          <li>Expenses: various payment methods including Cash</li>
          <li>No duplicate cash expenses in movements</li>
        </ul>
      </div>
      <div class="admin-actions">
        <button class="btn btn-primary" id="generate-btn">
          Generate Clean Test Data
        </button>
        <button class="btn btn-danger" id="clear-btn">
          Clear All Data (Use Carefully!)
        </button>
      </div>
      <div id="generate-status" class="status-message"></div>
    </div>

    <div class="admin-section">
      <h2>Data Analysis</h2>
      <div id="analysis-results" class="data-info" style="display:none;">
        <h4>Current Data Summary:</h4>
        <div id="analysis-content"></div>
      </div>
    </div>
  </div>

  <script>
    // Admin functions are now loaded globally from admin-functions.js
    // Register page initializer for SPA
    window.registerPageInitializer('admin-tools', function() {
      console.log('Admin tools page initialized');
      
      // Attach event listeners to buttons
      const migrateBtn = document.getElementById('migrate-btn');
      const cleanupBtn = document.getElementById('cleanup-btn');
      const analyzeBtn = document.getElementById('analyze-btn');
      const generateBtn = document.getElementById('generate-btn');
      const clearBtn = document.getElementById('clear-btn');
      
      if (migrateBtn) {
        migrateBtn.addEventListener('click', window.migrateToBalanceTracking);
      }
      if (cleanupBtn) {
        cleanupBtn.addEventListener('click', window.cleanupCashExpenses);
      }
      if (analyzeBtn) {
        analyzeBtn.addEventListener('click', window.analyzeCashData);
      }
      if (generateBtn) {
        generateBtn.addEventListener('click', window.generateCleanTestData);
      }
      if (clearBtn) {
        clearBtn.addEventListener('click', () => window.clearAllData(false));
      }
      
      // Auto-analyze data when page loads
      if (window.analyzeCashData) {
        window.analyzeCashData();
      }
    });
  </script>