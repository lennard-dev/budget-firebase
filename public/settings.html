<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Settings</title>
    <link rel="stylesheet" href="/shared.css" />
    <script defer src="/__/firebase/12.1.0/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-firestore-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/init.js"></script>
    <script defer src="/app.js"></script>
    <script defer src="/settings.js"></script>
  </head>
  <body class="app-container" id="settings-page">
    <div class="nav-header">
      <div class="nav-brand"><h1>Par√©a Lesvos Budget Management</h1></div>
      <nav class="nav-menu">
        <a href="/index.html" class="nav-link" data-page="dashboard"><span class="nav-icon">üìä</span><span class="nav-text">Dashboard</span></a>
        <a href="/expenses.html" class="nav-link" data-page="expenses"><span class="nav-icon">üí∞</span><span class="nav-text">Expenses</span></a>
        <a href="/budgets.html" class="nav-link" data-page="budget"><span class="nav-icon">üìà</span><span class="nav-text">Budgets</span></a>
        <a href="/cash-banking.html" class="nav-link" data-page="cash-banking"><span class="nav-icon">üè¶</span><span class="nav-text">Cash & Banking</span></a>
        <a href="/settings.html" class="nav-link active" data-page="settings"><span class="nav-icon">‚öôÔ∏è</span><span class="nav-text">Settings</span></a>
        <button id="signout" class="btn btn-secondary" style="margin-left:12px;">Sign out</button>
      </nav>
    </div>
    <div class="content-area">
      <div class="page-header">
        <h2 class="page-title">Settings</h2>
        <div class="page-actions">
          <a class="btn btn-secondary" href="/index.html">Home</a>
        </div>
      </div>

      <div class="tab-container">
        <div class="tab-header">
          <button class="tab-button active" onclick="switchSettingsTab('categories')">Categories</button>
          <button class="tab-button" onclick="switchSettingsTab('payment-methods')">Payment Methods</button>
          <button class="tab-button" onclick="switchSettingsTab('donors')">Donors</button>
          <button class="tab-button" onclick="switchSettingsTab('app-settings')">App Settings</button>
          <button class="tab-button" onclick="switchSettingsTab('import-data')">Import Data</button>
          <button class="tab-button" onclick="switchSettingsTab('admin-tools')">Admin Tools</button>
        </div>

        <div id="categories-tab" class="tab-content active">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Expense Categories</h3>
              <button class="btn btn-primary" id="addCategory">‚ûï Add Category</button>
            </div>
            <div class="card-body">
              <table class="data-table"><thead><tr><th>Name</th><th>Code</th><th>Subcategories</th><th>Status</th><th>Actions</th></tr></thead><tbody id="categories"></tbody></table>
            </div>
          </div>
        </div>

        <div id="payment-methods-tab" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Payment Methods</h3>
              <button class="btn btn-primary" id="addPayment">‚ûï Add Method</button>
            </div>
            <div class="card-body">
              <table class="data-table"><thead><tr><th>Name</th><th>Sort</th><th>Status</th><th>Actions</th></tr></thead><tbody id="payments"></tbody></table>
            </div>
          </div>
        </div>

        <div id="donors-tab" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Donors</h3>
              <button class="btn btn-primary" id="addDonor">‚ûï Add Donor</button>
            </div>
            <div class="card-body">
              <table class="data-table"><thead><tr><th>Name</th><th>Organization</th><th>Email</th><th>Phone</th><th>Status</th><th>Actions</th></tr></thead><tbody id="donors"></tbody></table>
            </div>
          </div>
        </div>

        <div id="app-settings-tab" class="tab-content">
          <div class="card">
            <div class="card-header"><h3 class="card-title">Application Settings</h3></div>
            <div class="card-body">
              <div class="grid grid-2">
                <div class="form-group"><label class="form-label">Organization Name</label><input id="org" type="text" class="form-control" /></div>
                <div class="form-group"><label class="form-label">Currency</label><select id="cur" class="form-control"><option>EUR</option><option>USD</option><option>GBP</option></select></div>
              </div>
              <div class="form-group"><label class="form-label">Fiscal Year Start</label><select id="fys" class="form-control"><option value="1">January</option><option value="4">April</option><option value="7">July</option><option value="10">October</option></select></div>
              <button class="btn btn-primary" id="save">Save General Settings</button>
            </div>
          </div>
        </div>

        <div id="import-data-tab" class="tab-content">
          <div class="card">
            <div class="card-header"><h3 class="card-title">Import CSV</h3></div>
            <div class="card-body">
              <input type="file" id="file" accept=".csv" class="form-control" />
              <button class="btn btn-secondary mt-2" id="upload">Upload</button>
              <pre id="log" class="mt-2" style="white-space:pre-wrap;"></pre>
            </div>
          </div>
        </div>

        <div id="admin-tools-tab" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Admin Tools - Data Management</h3>
            </div>
            <div class="card-body">
              <div style="background:#f8f9fa;padding:12px;border-radius:4px;margin-bottom:16px;">
                <strong>Current Issue:</strong> Cash expenses exist in two places:
                <ul style="margin-top:8px;">
                  <li>‚úÖ Correct: In the expenses collection (with paymentMethod = "Cash")</li>
                  <li>‚ùå Incorrect: Duplicated in the cash-movements collection</li>
                </ul>
              </div>
              
              <div style="background:#fff3cd;border:1px solid #ffc107;padding:12px;border-radius:4px;margin-bottom:16px;">
                ‚ö†Ô∏è <strong>Warning:</strong> These tools will modify your data. Use carefully!
              </div>
              
              <div style="margin-bottom:20px;">
                <h4>Data Analysis</h4>
                <button class="btn btn-secondary" onclick="analyzeCashData()">Analyze Current Data</button>
                <div id="analysis-results" style="margin-top:12px;display:none;">
                  <div id="analysis-content"></div>
                </div>
              </div>
              
              <div style="margin-bottom:20px;">
                <h4>Clean Up Duplicate Cash Expenses</h4>
                <p>This will remove ALL cash-expense entries from cash-movements while preserving legitimate movements.</p>
                <button class="btn btn-warning" onclick="cleanupCashExpenses()">Remove Duplicate Cash Expenses</button>
                <div id="cleanup-status" style="margin-top:12px;"></div>
              </div>
              
              <div>
                <h4>Generate Clean Test Data</h4>
                <p>Create fresh test data with proper separation (no duplicate cash expenses).</p>
                <button class="btn btn-primary" onclick="generateCleanTestData()">Generate Clean Test Data</button>
                <button class="btn btn-danger" onclick="clearAllData()" style="margin-left:8px;">Clear All Data</button>
                <div id="generate-status" style="margin-top:12px;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Admin functions are now loaded globally from admin-functions.js
      // The functions cleanupCashExpenses, analyzeCashData, generateCleanTestData, and clearAllData
      // are available globally and can be called directly from the onclick handlers
    </script>
  </body>
  </html>


