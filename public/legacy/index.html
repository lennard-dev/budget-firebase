<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Budget Management</title>
    <link rel="stylesheet" href="/legacy/shared.css" />
    <link rel="icon" href="data:," />

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/12.1.0/firebase-app-compat.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/12.1.0/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-firestore-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-messaging-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-storage-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-analytics-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-remote-config-compat.js"></script>
    <script defer src="/__/firebase/12.1.0/firebase-performance-compat.js"></script>
    <!-- Firebase configuration fallback for local development -->
    <script src="/legacy/firebase-config.js"></script>
    <!--
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js"></script>
    <!-- Chart.js for Dashboard Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Admin functions (temporary - to be cleaned) -->
    <script src="/legacy/admin-functions.js"></script>
    <!-- Transaction Service - Single unified service -->
    <script src="/legacy/transaction-service.js"></script>
    <!-- Important: Do not globally load settings.js; each page script is executed from its partial to avoid early API calls -->
    <script defer src="/legacy/app.js"></script>

    <style media="screen">
      :root { color-scheme: light; }
      body { background: var(--color-bg); color: var(--color-text); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      .signin-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 24px; }
      .signin-card { width: 100%; max-width: 420px; background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); padding: 28px; }
      .signin-header { display:flex; align-items:center; gap:10px; margin-bottom: 16px; }
      .signin-title { font-size: 20px; font-weight: 600; margin: 0; }
      .signin-sub { color: #64748b; font-size: 13px; margin-bottom: 16px; }
      .google-btn { width: 100%; display: inline-flex; align-items:center; justify-content:center; gap:10px; padding: 10px 14px; border-radius: 8px; border: 1px solid #e2e8f0; background: #fff; cursor:pointer; font-weight: 600; }
      .google-btn:hover { background:#f8fafc; }
      .google-icon { width:18px; height:18px; }
      .auth-error { display:none; margin-top:12px; color:#b91c1c; background:#fee2e2; border:1px solid #fecaca; padding:8px 10px; border-radius:6px; font-size: 13px; }
      .spinner { display:none; width:16px; height:16px; border:2px solid #e2e8f0; border-top-color:#64748b; border-radius:50%; animation: spin 0.8s linear infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
      nav a { margin-right: 8px; }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="auth" class="signin-container">
        <div class="signin-card">
          <div class="signin-header">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-icon" alt="Google"/>
            <h1 class="signin-title">Sign in</h1>
          </div>
          <div class="signin-sub">Use your Google account to continue to Paréa Lesvos Budget Management.</div>
          <button id="google-signin" class="google-btn">
            <span class="spinner" id="auth-spinner"></span>
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-icon" alt=""/>
            Continue with Google
          </button>
          <button id="test-signin" class="google-btn" style="margin-top: 12px; background: #fef3c7; border-color: #fbbf24;">
            🧪 Test Login (Admin User - Local Only)
          </button>
          <div id="auth-error" class="auth-error"></div>
        </div>
      </div>
      <div id="content" style="display:none;">
        <!-- Google App Style Header -->
        <header class="app-header">
          <div class="header-left">
            <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
            <div class="app-logo">
              <div class="logo-icon">PL</div>
              <span class="logo-text">Paréa Lesvos Budget Management</span>
            </div>
          </div>
          <div class="header-right">
            <button class="header-btn" aria-label="Notifications">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
              </svg>
            </button>
            <button class="header-btn" aria-label="Google Apps">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="6" height="6"></rect>
                <rect x="15" y="3" width="6" height="6"></rect>
                <rect x="3" y="15" width="6" height="6"></rect>
                <rect x="15" y="15" width="6" height="6"></rect>
                <rect x="9" y="9" width="6" height="6"></rect>
              </svg>
            </button>
            <div class="user-menu">
              <button class="user-avatar" id="user-menu-btn" aria-label="User menu">
                <span class="avatar-fallback">U</span>
              </button>
              <div class="user-dropdown" id="user-dropdown">
                <button id="signout" class="dropdown-item">Sign out</button>
              </div>
            </div>
          </div>
        </header>

        <!-- Sidebar Navigation -->
        <aside class="app-sidebar" id="app-sidebar">
          <nav class="sidebar-nav">
            <a href="#dashboard" class="sidebar-link active" data-page="dashboard">
              <svg class="sidebar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="9"></rect>
                <rect x="14" y="3" width="7" height="5"></rect>
                <rect x="14" y="12" width="7" height="9"></rect>
                <rect x="3" y="16" width="7" height="5"></rect>
              </svg>
              <span class="sidebar-text">Dashboard</span>
            </a>
            <a href="#expenses" class="sidebar-link" data-page="expenses">
              <svg class="sidebar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14,2 14,8 20,8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10,9 9,9 8,9"></polyline>
              </svg>
              <span class="sidebar-text">Expenses</span>
            </a>
            <a href="#budget" class="sidebar-link" data-page="budget">
              <svg class="sidebar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
              <span class="sidebar-text">Budget</span>
            </a>
            <a href="#cash-banking" class="sidebar-link" data-page="cash-banking">
              <svg class="sidebar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                <line x1="1" y1="10" x2="23" y2="10"></line>
              </svg>
              <span class="sidebar-text">Cash & Banking</span>
            </a>
            <a href="#reports" class="sidebar-link" data-page="reports">
              <svg class="sidebar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
                <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
              </svg>
              <span class="sidebar-text">Reports</span>
            </a>
            <a href="#admin-tools" class="sidebar-link" data-page="admin-tools">
              <svg class="sidebar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"></path>
                <circle cx="12" cy="12" r="2"></circle>
              </svg>
              <span class="sidebar-text">Admin Tools</span>
            </a>
          </nav>
          <div class="sidebar-footer">
            <a href="#settings" class="sidebar-link" data-page="settings">
              <svg class="sidebar-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"></path>
              </svg>
              <span class="sidebar-text">Settings</span>
            </a>
          </div>
        </aside>

        <!-- Main Content Area -->
        <main class="app-main">
          <div id="page-root" class="main-content"></div>
        </main>
        
        <!-- Mobile Bottom Navigation (hidden on desktop) -->
        <div class="mobile-bottom-nav" id="mobile-bottom-nav">
          <a href="#dashboard" class="mobile-nav-item active" data-page="dashboard">
            <span class="mobile-nav-icon">📊</span>
            <span class="mobile-nav-text">Dashboard</span>
          </a>
          <a href="#expenses" class="mobile-nav-item" data-page="expenses">
            <span class="mobile-nav-icon">💰</span>
            <span class="mobile-nav-text">Expenses</span>
          </a>
          <a href="#budget" class="mobile-nav-item" data-page="budget">
            <span class="mobile-nav-icon">📈</span>
            <span class="mobile-nav-text">Budget</span>
          </a>
          <a href="#cash-banking" class="mobile-nav-item" data-page="cash-banking">
            <span class="mobile-nav-icon">🏦</span>
            <span class="mobile-nav-text">Banking</span>
          </a>
          <a href="#reports" class="mobile-nav-item" data-page="reports">
            <span class="mobile-nav-icon">📋</span>
            <span class="mobile-nav-text">Reports</span>
          </a>
        </div>
        
        <div id="modal-root"></div>
        
        <!-- Sidebar overlay for mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
      </div>
    </div>

    <script></script>
  </body>
</html>
